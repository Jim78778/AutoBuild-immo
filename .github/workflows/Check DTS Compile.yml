name: Check DTS compile (swaiot CPE-S10)

on:
  workflow_dispatch:
  push:
    paths:
      - "target/linux/**.dts"
      - "target/linux/**.dtsi"

jobs:
  check-dts:
    runs-on: ubuntu-22.04

    steps:
    - name: Checkout OpenWrt source
      uses: actions/checkout@v4
      with:
        repository: Jim78778/openwrt-ipq
        ref: swaiot-s10
        fetch-depth: 1

    - name: Install dtc
      run: |
        sudo apt-get update
        sudo apt-get install -y device-tree-compiler

    - name: Compile swaiot CPE-S10 DTS
      run: |
        set -e

        DTS=target/linux/qualcommax/files/arch/arm64/boot/dts/qcom/ipq807x-swaiot_cpe_s10.dts

        echo "Using DTS: $DTS"
        test -f "$DTS"

        dtc -I dts -O dtb \
          -i target/linux/qualcommax/files \
          "$DTS" \
          -o /tmp/swaiot_cpe_s10.dtb

        echo "DTS compile OK"

name: Check DTS compile (swaiot S10)

on:
  workflow_dispatch:
  push:
    paths:
      - "target/linux/qualcommax/files/arch/arm64/boot/dts/**/*.dts"
      - "target/linux/qualcommax/files/arch/arm64/boot/dts/**/*.dtsi"

jobs:
  check-dts:
    runs-on: ubuntu-22.04

    steps:
    - name: Checkout source
      uses: actions/checkout@v4
      with:
        repository: Jim78778/openwrt-ipq
        ref: swaiot-s10
        fetch-depth: 1

    - name: Install dtc
      run: |
        sudo apt-get update
        sudo apt-get install -y device-tree-compiler

    - name: Compile swaiot S10 DTS
      run: |
        set -eux

        DTS=target/linux/qualcommax/files/arch/arm64/boot/dts/qcom/ipq8071-s10.dts

        echo "Using DTS: $DTS"
        ls -l "$DTS"

        dtc -Wno-unit_address_vs_reg -Wno-avoid_unnecessary_addr_size \
        -I dts -O dtb \
        -i target/linux/qualcommax/files/arch/arm64/boot/dts \
        -i target/linux/qualcommax/files/arch/arm64/boot/dts/qcom \
        target/linux/qualcommax/files/arch/arm64/boot/dts/qcom/ipq8071-s10.dts \
        -o /tmp/ipq8071-s10.dtb


        ls -lh /tmp/ipq8071-s10.dtb
        echo "DTS compile OK"
